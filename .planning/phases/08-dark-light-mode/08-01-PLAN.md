---
phase: 08-dark-light-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/store/useBrandStore.js
  - tailwind.config.js
  - index.html
autonomous: true

must_haves:
  truths:
    - "Theme state persists across page refreshes"
    - "No flash of wrong theme on page load"
    - "Tailwind dark: variants are available"
  artifacts:
    - path: "src/store/useBrandStore.js"
      provides: "theme state with 'light' | 'dark' | 'system' and setTheme action"
      contains: "theme:"
    - path: "tailwind.config.js"
      provides: "darkMode selector configuration"
      contains: "darkMode"
    - path: "index.html"
      provides: "FOUC prevention inline script"
      contains: "localStorage.getItem"
  key_links:
    - from: "index.html"
      to: "localStorage"
      via: "inline script reads theme before React"
      pattern: "classList\\.add.*dark"
    - from: "src/store/useBrandStore.js"
      to: "localStorage"
      via: "zustand persist middleware"
      pattern: "persist\\("
---

<objective>
Set up the foundational infrastructure for dark/light mode theming.

Purpose: Enable the app to support dark and light themes with persisted preference, prevent flash of unstyled content (FOUC), and configure Tailwind for class-based dark mode switching.

Output: Theme state in Zustand store, Tailwind dark mode config, FOUC prevention script in index.html
</objective>

<execution_context>
@/Users/sannagranqvist/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sannagranqvist/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-dark-light-mode/08-RESEARCH.md
@src/store/useBrandStore.js
@tailwind.config.js
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add theme state to Zustand store</name>
  <files>src/store/useBrandStore.js</files>
  <action>
Add theme state and actions to the existing useBrandStore. The store already uses zustand with persist middleware.

Add to the store state:
- `theme: 'system'` - Initial value, can be 'light' | 'dark' | 'system'
- `resolvedTheme: 'light'` - The computed theme based on system preference or explicit choice

Add actions:
- `setTheme: (theme) => set({ theme })` - Set explicit theme preference
- `setResolvedTheme: (resolved) => set({ resolvedTheme: resolved })` - Internal action for computed theme

Ensure `theme` is included in the persist partialize function (if one exists), but `resolvedTheme` should NOT be persisted (it's computed at runtime).

DO NOT modify any existing functionality. Only ADD new theme-related state and actions.
  </action>
  <verify>
Search the file for 'theme:' to confirm state exists.
Search for 'setTheme' to confirm action exists.
Run `npm run build` or `npm run dev` to ensure no syntax errors.
  </verify>
  <done>
Store exports theme state ('light' | 'dark' | 'system') and setTheme action.
resolvedTheme exists for runtime computed theme.
Theme persists to localStorage via existing persist middleware.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Tailwind for selector-based dark mode</name>
  <files>tailwind.config.js</files>
  <action>
Update tailwind.config.js to enable class-based dark mode switching.

Add to the config object (at the top level, not inside theme):
```js
darkMode: 'selector',
```

This enables Tailwind's dark: variants to work when a `.dark` class is present on any ancestor element (typically the html or body element).

Note: In Tailwind v3.4+, 'selector' is preferred over 'class' for more flexibility.
  </action>
  <verify>
Read tailwind.config.js and confirm `darkMode: 'selector'` is present.
Run `npm run build` to confirm no config errors.
  </verify>
  <done>
Tailwind config has `darkMode: 'selector'` at the top level.
dark: variants will activate when .dark class is on an ancestor.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add FOUC prevention script to index.html</name>
  <files>index.html</files>
  <action>
Add an inline script in the `<head>` section of index.html that runs BEFORE React loads. This prevents the flash of wrong theme.

Add this script inside `<head>`, after the meta tags but before any other scripts:

```html
<script>
  (function() {
    const stored = localStorage.getItem('brand-store');
    let theme = 'system';
    if (stored) {
      try {
        const parsed = JSON.parse(stored);
        theme = parsed.state?.theme || 'system';
      } catch (e) {}
    }

    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const resolved = theme === 'system' ? (prefersDark ? 'dark' : 'light') : theme;

    if (resolved === 'dark') {
      document.documentElement.classList.add('dark');
    }
  })();
</script>
```

This script:
1. Reads the persisted theme from localStorage (using the same key as Zustand persist)
2. Checks system preference if theme is 'system'
3. Adds .dark class to `<html>` if dark mode should be active
4. Runs synchronously before any rendering happens

The key 'brand-store' must match the name used in useBrandStore's persist config.
  </action>
  <verify>
Read index.html and confirm the inline script is present in the head.
Confirm it references 'brand-store' (matching the Zustand persist key).
Open the app and check Elements panel - html element should have class="dark" if system prefers dark.
  </verify>
  <done>
index.html has inline FOUC prevention script in head.
Script reads from localStorage before React renders.
.dark class is applied to html element synchronously.
  </done>
</task>

</tasks>

<verification>
1. Theme state exists in store: `grep -n "theme:" src/store/useBrandStore.js`
2. Tailwind config correct: `grep -n "darkMode" tailwind.config.js`
3. FOUC script present: `grep -n "classList.add" index.html`
4. Build succeeds: `npm run build`
5. Manual test: Open app, check DevTools > Elements, verify .dark class on html when system is dark mode
</verification>

<success_criteria>
- Theme state ('light' | 'dark' | 'system') exists in Zustand store
- Theme persists across page refreshes (check localStorage)
- Tailwind dark: variants are configured and ready
- No FOUC when loading page with dark theme preference
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-dark-light-mode/08-01-SUMMARY.md`
</output>
