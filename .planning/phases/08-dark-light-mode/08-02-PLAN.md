---
phase: 08-dark-light-mode
plan: 02
type: execute
wave: 2
depends_on: [08-01]
files_modified:
  - src/hooks/useTheme.ts
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Theme changes when user selects a different option"
    - "System preference changes are detected and applied"
    - ".dark class toggles on html element when theme changes"
  artifacts:
    - path: "src/hooks/useTheme.ts"
      provides: "useTheme hook with theme state, setTheme, resolvedTheme, and system preference sync"
      exports: ["useTheme"]
    - path: "src/App.tsx"
      provides: "Theme initialization and class management via useTheme"
      contains: "useTheme"
  key_links:
    - from: "src/hooks/useTheme.ts"
      to: "useBrandStore"
      via: "reads and writes theme state"
      pattern: "useBrandStore"
    - from: "src/hooks/useTheme.ts"
      to: "document.documentElement"
      via: "adds/removes .dark class"
      pattern: "classList"
    - from: "src/App.tsx"
      to: "src/hooks/useTheme.ts"
      via: "hook initialization"
      pattern: "useTheme\\(\\)"
---

<objective>
Create the useTheme hook and integrate theme management into the app.

Purpose: Provide a centralized hook that handles theme state, system preference detection, and DOM class management. This hook will be used by the App component to initialize theming and by any component that needs to read or change the theme.

Output: useTheme hook in src/hooks/useTheme.ts, integrated into App.tsx
</objective>

<execution_context>
@/Users/sannagranqvist/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sannagranqvist/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-dark-light-mode/08-RESEARCH.md
@.planning/phases/08-dark-light-mode/08-01-SUMMARY.md
@src/store/useBrandStore.js
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useTheme hook</name>
  <files>src/hooks/useTheme.ts</files>
  <action>
Create a new file `src/hooks/useTheme.ts` that provides theme management functionality.

The hook should:
1. Read theme and resolvedTheme from useBrandStore
2. Provide setTheme action
3. Listen for system preference changes via matchMedia
4. Apply/remove .dark class to document.documentElement
5. Update resolvedTheme when theme is 'system' and system preference changes

```typescript
import { useEffect } from 'react';
import { useBrandStore } from '../store/useBrandStore';

export function useTheme() {
  const theme = useBrandStore((state) => state.theme);
  const setTheme = useBrandStore((state) => state.setTheme);
  const resolvedTheme = useBrandStore((state) => state.resolvedTheme);
  const setResolvedTheme = useBrandStore((state) => state.setResolvedTheme);

  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');

    const updateResolvedTheme = () => {
      const systemPrefersDark = mediaQuery.matches;
      const resolved = theme === 'system'
        ? (systemPrefersDark ? 'dark' : 'light')
        : theme;

      setResolvedTheme(resolved);

      // Update DOM
      if (resolved === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    };

    // Initial update
    updateResolvedTheme();

    // Listen for system preference changes
    mediaQuery.addEventListener('change', updateResolvedTheme);

    return () => {
      mediaQuery.removeEventListener('change', updateResolvedTheme);
    };
  }, [theme, setResolvedTheme]);

  return {
    theme,
    setTheme,
    resolvedTheme,
  };
}
```

Key behaviors:
- When theme is 'system', resolvedTheme follows OS preference
- When theme is 'light' or 'dark', resolvedTheme matches theme
- .dark class is added/removed from html element
- System preference changes are detected in real-time
  </action>
  <verify>
File exists at src/hooks/useTheme.ts.
Contains useEffect with matchMedia listener.
Exports useTheme function.
  </verify>
  <done>
useTheme hook exports theme, setTheme, and resolvedTheme.
Hook manages .dark class on document.documentElement.
System preference changes are detected and applied.
  </done>
</task>

<task type="auto">
  <name>Task 2: Initialize useTheme in App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Import and call the useTheme hook at the top of the App component to initialize theme management.

Add to imports at the top of App.tsx:
```typescript
import { useTheme } from './hooks/useTheme';
```

At the beginning of the App component (before any other hooks or state):
```typescript
export default function App() {
  // Initialize theme management
  useTheme();

  // ... rest of existing code
```

This ensures:
1. Theme is initialized on app mount
2. System preference listener is active
3. .dark class is managed correctly

DO NOT modify any other part of App.tsx. Only add the import and hook call.
  </action>
  <verify>
`grep -n "useTheme" src/App.tsx` shows import and hook call.
App still runs without errors: `npm run dev` and check browser.
  </verify>
  <done>
App.tsx imports and calls useTheme hook.
Theme management initializes on app mount.
No regression in existing functionality.
  </done>
</task>

</tasks>

<verification>
1. Hook file exists: `ls src/hooks/useTheme.ts`
2. Hook exports correctly: `grep "export function useTheme" src/hooks/useTheme.ts`
3. App uses hook: `grep "useTheme" src/App.tsx`
4. Build succeeds: `npm run build`
5. Manual test:
   - Open app
   - Check DevTools > Elements > html element
   - Toggle system dark mode in OS settings
   - Verify .dark class changes accordingly
</verification>

<success_criteria>
- useTheme hook exists and exports theme, setTheme, resolvedTheme
- App.tsx calls useTheme() to initialize theme management
- .dark class is applied/removed on document.documentElement based on theme
- System preference changes are detected and applied in real-time
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-dark-light-mode/08-02-SUMMARY.md`
</output>
