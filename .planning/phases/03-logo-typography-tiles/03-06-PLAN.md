---
phase: 03-logo-typography-tiles
plan: 06
type: execute
wave: 4
depends_on: ["03-02", "03-04", "03-05"]
files_modified:
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "Logo tile displays and is editable via panel"
    - "Primary typography tile displays specimen and is editable"
    - "Secondary typography tile displays body text and is editable"
    - "Font picker search, filters, and hover preview all work"
    - "Undo/redo works for all changes"
    - "All fonts load from Google Fonts on-demand"
  artifacts: []
  key_links: []
---

<objective>
Integration checkpoint: Verify all Phase 3 components work together in the application.

Purpose: Ensure logo tile, typography tiles, edit panels, font picker, and undo/redo function correctly as a system.
Output: Verified Phase 3 implementation ready for Phase 2 canvas integration.
</objective>

<execution_context>
@/Users/sannagranqvist/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sannagranqvist/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-logo-typography-tiles/03-RESEARCH.md

# All prior Phase 3 plans
@.planning/phases/03-logo-typography-tiles/03-01-PLAN.md
@.planning/phases/03-logo-typography-tiles/03-02-PLAN.md
@.planning/phases/03-logo-typography-tiles/03-03-PLAN.md
@.planning/phases/03-logo-typography-tiles/03-04-PLAN.md
@.planning/phases/03-logo-typography-tiles/03-05-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create integration test harness</name>
  <files>
    src/App.tsx
  </files>
  <action>
1. Update App.tsx to create a test harness for all Phase 3 components:
   ```typescript
   import { useState } from 'react';
   import { LogoTile, PrimaryFontTile, SecondaryFontTile } from '@/components/tiles';
   import { LogoEditPanel, FontEditPanel } from '@/components/panels';
   import { useCanvasStore, useTemporalStore } from '@/state/canvasState';
   import './App.css';

   type EditingTile = 'logo' | 'primaryFont' | 'secondaryFont' | null;

   function App() {
     const [editingTile, setEditingTile] = useState<EditingTile>(null);
     const [previewFont, setPreviewFont] = useState<string | null>(null);

     const temporal = useTemporalStore();
     const { primaryFont, secondaryFont, logo } = useCanvasStore(state => state.assets);

     const handleClose = () => {
       setEditingTile(null);
       setPreviewFont(null);
     };

     return (
       <div className="app">
         <header className="app-header">
           <h1>Phase 3: Logo & Typography Tiles</h1>
           <div className="header-actions">
             <button
               onClick={() => temporal.undo()}
               disabled={temporal.pastStates.length === 0}
             >
               Undo ({temporal.pastStates.length})
             </button>
             <button
               onClick={() => temporal.redo()}
               disabled={temporal.futureStates.length === 0}
             >
               Redo ({temporal.futureStates.length})
             </button>
           </div>
         </header>

         <main className="test-grid">
           {/* Logo Tile */}
           <div className="tile-container">
             <LogoTile
               onClick={() => setEditingTile('logo')}
               isEditing={editingTile === 'logo'}
             />
             {editingTile === 'logo' && (
               <div className="edit-panel-container">
                 <LogoEditPanel onClose={handleClose} />
               </div>
             )}
           </div>

           {/* Primary Font Tile */}
           <div className="tile-container">
             <PrimaryFontTile
               onClick={() => setEditingTile('primaryFont')}
               isEditing={editingTile === 'primaryFont'}
               previewFont={editingTile === 'primaryFont' ? previewFont : null}
             />
             {editingTile === 'primaryFont' && (
               <div className="edit-panel-container">
                 <FontEditPanel
                   role="primary"
                   onClose={handleClose}
                   onPreviewChange={setPreviewFont}
                 />
               </div>
             )}
           </div>

           {/* Secondary Font Tile */}
           <div className="tile-container">
             <SecondaryFontTile
               onClick={() => setEditingTile('secondaryFont')}
               isEditing={editingTile === 'secondaryFont'}
               previewFont={editingTile === 'secondaryFont' ? previewFont : null}
             />
             {editingTile === 'secondaryFont' && (
               <div className="edit-panel-container">
                 <FontEditPanel
                   role="secondary"
                   onClose={handleClose}
                   onPreviewChange={setPreviewFont}
                 />
               </div>
             )}
           </div>
         </main>

         <footer className="app-footer">
           <div className="state-display">
             <span>Primary: {primaryFont}</span>
             <span>Secondary: {secondaryFont}</span>
             <span>Logo: {logo ? 'Set' : 'None'}</span>
           </div>
         </footer>
       </div>
     );
   }

   export default App;
   ```

2. Add CSS to App.css:
   ```css
   .app {
     min-height: 100vh;
     background: #FAFAF8;
     padding: 24px;
     font-family: system-ui, sans-serif;
   }

   .app-header {
     display: flex;
     justify-content: space-between;
     align-items: center;
     margin-bottom: 32px;
   }

   .app-header h1 {
     margin: 0;
     font-size: 24px;
     font-weight: 600;
   }

   .header-actions {
     display: flex;
     gap: 8px;
   }

   .header-actions button {
     padding: 8px 16px;
     border: 1px solid #e0e0e0;
     background: white;
     border-radius: 6px;
     cursor: pointer;
     font-size: 13px;
   }

   .header-actions button:disabled {
     opacity: 0.5;
     cursor: not-allowed;
   }

   .header-actions button:hover:not(:disabled) {
     background: #f5f5f5;
   }

   .test-grid {
     display: grid;
     grid-template-columns: repeat(3, 1fr);
     gap: 16px;
     max-width: 1200px;
     margin: 0 auto;
   }

   .tile-container {
     position: relative;
   }

   .tile-container > .tile {
     aspect-ratio: 1;
     background: white;
     border-radius: 12px;
     box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
     cursor: pointer;
     transition: box-shadow 200ms ease;
   }

   .tile-container > .tile:hover {
     box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
   }

   .tile-container > .tile.editing {
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }

   .edit-panel-container {
     position: absolute;
     top: 100%;
     left: 0;
     right: 0;
     margin-top: 8px;
     z-index: 10;
   }

   .app-footer {
     margin-top: 32px;
     padding-top: 16px;
     border-top: 1px solid #e0e0e0;
   }

   .state-display {
     display: flex;
     gap: 24px;
     font-size: 13px;
     color: #666;
   }

   @media (max-width: 768px) {
     .test-grid {
       grid-template-columns: 1fr;
     }
   }
   ```
  </action>
  <verify>
    App runs: `npm run dev`
    All three tiles render without errors
    Test harness displays undo/redo counts
  </verify>
  <done>
    App compiles without TypeScript errors, runs on localhost, all 3 tiles (logo, primary font, secondary font) render and are clickable, edit panels open when tiles are clicked and close when X button is clicked
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 3 implementation:
- Logo tile with adaptive background, upload, variants, scale, background controls
- Primary typography tile with font specimen display
- Secondary typography tile with body text display
- Font picker with search, filters, categories, recent fonts, virtualized list
- Font edit panels with weight/size/line-height sliders
- Undo/redo with single step per slider drag
- On-demand Google Fonts loading with fallback
  </what-built>
  <how-to-verify>
1. Open http://localhost:5173 (or appropriate port)

**Logo Tile Tests:**
2. Click logo tile - edit panel opens
3. Upload a logo (SVG, PNG, or JPG) - logo appears in tile
4. Adjust scale slider - logo size changes (40-100%)
5. Toggle variants (Original, Dark, Light) - logo color changes
6. Toggle background (Auto, White, Dark, Brand) - tile background changes
7. With 'Auto' selected, verify background adapts based on logo brightness
8. Close panel (X button)

**Typography Tile Tests:**
9. Click primary font tile - edit panel opens
10. Type "Montserrat" in search - font list filters
11. Hover over "Montserrat" - font preview appears in tile immediately
12. Click "Montserrat" - font commits, tile updates
13. Adjust weight slider - weight changes (notice dot indicator)
14. Adjust size slider - text size changes
15. Adjust line height slider - spacing changes
16. Close panel

17. Click secondary font tile - separate edit panel
18. Select a serif font (e.g., "Merriweather")
19. Verify it updates body text tile

**Undo/Redo Tests:**
20. Note undo count in header
21. Make 3 changes (font, weight, size)
22. Verify undo count is 3
23. Click Undo 3 times - changes revert in order
24. Click Redo - changes reapply
25. Drag slider slowly through multiple values
26. Release slider
27. Click Undo once - should revert to pre-drag value (single step)

**Font Picker Tests:**
28. Open font picker, verify popular fonts shown first
29. Click category filters - list filters correctly
30. Scroll font list - should be smooth (virtualized)
31. Select a font - verify it appears in "Recent" section next time
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe specific issues to fix</resume-signal>
</task>

</tasks>

<verification>
All Phase 3 requirements verified:
- LOGO-01: Logo centered with 24px padding
- LOGO-02: Adaptive background when 'auto' selected (luminance detection)
- LOGO-03: Upload replacement logo
- LOGO-04: Toggle Original/Dark/Light variants
- LOGO-05: Adjust scale 40-100%
- LOGO-06: Toggle tile background (auto, white, dark, brand)

- TYPE-01: Primary tile shows specimen
- TYPE-02: Secondary tile shows body text
- TYPE-03: Font picker with search
- TYPE-04: Category filters
- TYPE-05: Popular fonts default
- TYPE-06: Recent fonts pinned
- TYPE-07: Font names in own typeface
- TYPE-08: Hover preview
- TYPE-09: Click commits
- TYPE-10: Weight slider
- TYPE-11: Size slider
- TYPE-12: Line height slider
- TYPE-13: Single undo per drag
- TYPE-14: On-demand loading
- TYPE-15: Fallback on failure
</verification>

<success_criteria>
- All tiles render and are clickable
- All edit panels open and close correctly
- Font picker search, filter, and select all work
- Hover preview updates tile without committing
- All sliders work with live preview
- Undo/redo works for all changes
- Single undo step per slider drag
- Fonts load from Google Fonts
- No console errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-logo-typography-tiles/03-06-SUMMARY.md`
</output>
