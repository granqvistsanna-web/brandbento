---
phase: 03-logo-typography-tiles
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/tiles/LogoTile.tsx
  - src/components/panels/LogoEditPanel.tsx
  - src/components/controls/Slider.tsx
  - src/components/controls/ToggleGroup.tsx
autonomous: true

must_haves:
  truths:
    - "Logo displays centered with minimum 24px padding"
    - "Logo background auto-adapts based on luminance when set to auto"
    - "User can upload replacement logo via file input"
    - "User can toggle between Original, Dark, Light variants"
    - "User can adjust logo scale from 40-100%"
    - "User can toggle tile background between white, dark, brand primary, or auto"
  artifacts:
    - path: "src/components/tiles/LogoTile.tsx"
      provides: "Logo display with adaptive background"
      min_lines: 50
    - path: "src/components/panels/LogoEditPanel.tsx"
      provides: "Logo customization controls"
      min_lines: 80
    - path: "src/components/controls/Slider.tsx"
      provides: "Reusable slider with onChangeEnd for undo batching"
      min_lines: 40
  key_links:
    - from: "src/components/tiles/LogoTile.tsx"
      to: "src/hooks/useImageLuminance.ts"
      via: "hook call for adaptive background"
      pattern: "useImageLuminance"
    - from: "src/components/panels/LogoEditPanel.tsx"
      to: "src/state/canvasState.ts"
      via: "setLogoScale, setLogoVariant, setLogoBackground"
      pattern: "useCanvasStore"
---

<objective>
Create the Logo tile with display, adaptive background, and full edit panel with upload, variants, scale, and background controls.

Purpose: Logo tile is the first content tile with full editing capabilities, establishing the pattern for all edit panels.
Output: LogoTile component, LogoEditPanel component, reusable Slider and ToggleGroup controls.
</objective>

<execution_context>
@/Users/sannagranqvist/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sannagranqvist/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-logo-typography-tiles/03-RESEARCH.md

# Prior plan (luminance, state)
@.planning/phases/03-logo-typography-tiles/03-01-PLAN.md

# Existing components
@src/components/Tile.tsx
@src/state/canvasState.ts
@src/hooks/useImageLuminance.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reusable Slider and ToggleGroup controls</name>
  <files>
    src/components/controls/Slider.tsx
    src/components/controls/ToggleGroup.tsx
    src/components/controls/index.ts
  </files>
  <action>
1. Create `src/components/controls/Slider.tsx` with pause/resume for single undo step:
   ```typescript
   import { useState, useCallback, useEffect } from 'react';
   import { useCanvasStore } from '@/state/canvasState';

   interface SliderProps {
     value: number;
     min: number;
     max: number;
     step?: number;
     label: string;
     onChange: (value: number) => void;
     formatValue?: (value: number) => string;
   }

   export function Slider({
     value,
     min,
     max,
     step = 1,
     label,
     onChange,
     formatValue = (v) => v.toString()
   }: SliderProps) {
     const [isDragging, setIsDragging] = useState(false);
     const [localValue, setLocalValue] = useState(value);

     // Sync external value when not dragging
     useEffect(() => {
       if (!isDragging) {
         setLocalValue(value);
       }
     }, [value, isDragging]);

     const handleChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {
       const newValue = parseFloat(e.target.value);
       setLocalValue(newValue);

       if (!isDragging) {
         setIsDragging(true);
         // Pause undo tracking
         useCanvasStore.temporal.getState().pause();
       }

       // Update state for live preview
       onChange(newValue);
     }, [isDragging, onChange]);

     const handleChangeEnd = useCallback(() => {
       if (isDragging) {
         setIsDragging(false);
         // Resume undo tracking - creates single undo step
         useCanvasStore.temporal.getState().resume();
       }
     }, [isDragging]);

     return (
       <div className="slider-control">
         <label className="slider-label">
           <span>{label}</span>
           <span className="slider-value">{formatValue(localValue)}</span>
         </label>
         <input
           type="range"
           min={min}
           max={max}
           step={step}
           value={localValue}
           onChange={handleChange}
           onMouseUp={handleChangeEnd}
           onTouchEnd={handleChangeEnd}
           onBlur={handleChangeEnd}
           className="slider-input"
         />
       </div>
     );
   }
   ```

   Add CSS in the component or global styles:
   ```css
   .slider-control {
     display: flex;
     flex-direction: column;
     gap: 8px;
   }
   .slider-label {
     display: flex;
     justify-content: space-between;
     font-size: 14px;
     color: #555;
   }
   .slider-value {
     font-weight: 500;
     color: #111;
   }
   .slider-input {
     width: 100%;
     height: 6px;
     -webkit-appearance: none;
     background: #e0e0e0;
     border-radius: 3px;
     cursor: pointer;
   }
   .slider-input::-webkit-slider-thumb {
     -webkit-appearance: none;
     width: 16px;
     height: 16px;
     background: #111;
     border-radius: 50%;
     cursor: grab;
   }
   ```

2. Create `src/components/controls/ToggleGroup.tsx`:
   ```typescript
   interface ToggleOption<T extends string> {
     value: T;
     label: string;
   }

   interface ToggleGroupProps<T extends string> {
     label: string;
     value: T;
     options: ToggleOption<T>[];
     onChange: (value: T) => void;
   }

   export function ToggleGroup<T extends string>({
     label,
     value,
     options,
     onChange
   }: ToggleGroupProps<T>) {
     return (
       <div className="toggle-group-control">
         <label className="toggle-group-label">{label}</label>
         <div className="toggle-group-buttons">
           {options.map(option => (
             <button
               key={option.value}
               type="button"
               className={`toggle-button ${value === option.value ? 'active' : ''}`}
               onClick={() => onChange(option.value)}
             >
               {option.label}
             </button>
           ))}
         </div>
       </div>
     );
   }
   ```

   Add CSS:
   ```css
   .toggle-group-control {
     display: flex;
     flex-direction: column;
     gap: 8px;
   }
   .toggle-group-label {
     font-size: 14px;
     color: #555;
   }
   .toggle-group-buttons {
     display: flex;
     gap: 4px;
   }
   .toggle-button {
     flex: 1;
     padding: 8px 12px;
     border: 1px solid #e0e0e0;
     background: white;
     border-radius: 6px;
     font-size: 13px;
     cursor: pointer;
     transition: all 150ms ease;
   }
   .toggle-button:hover {
     background: #f5f5f5;
   }
   .toggle-button.active {
     background: #111;
     color: white;
     border-color: #111;
   }
   ```

3. Create `src/components/controls/index.ts`:
   ```typescript
   export { Slider } from './Slider';
   export { ToggleGroup } from './ToggleGroup';
   ```
  </action>
  <verify>
    TypeScript compiles: `npx tsc --noEmit`
    Import components in App.tsx and render with test values - no errors
  </verify>
  <done>
    Slider with pause/resume for single undo step, ToggleGroup for option selection, both exported from controls/index.ts
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LogoTile with adaptive background</name>
  <files>
    src/components/tiles/LogoTile.tsx
  </files>
  <action>
1. Create `src/components/tiles/LogoTile.tsx`:
   ```typescript
   import { useCanvasStore } from '@/state/canvasState';
   import { useImageLuminance } from '@/hooks/useImageLuminance';

   interface LogoTileProps {
     onClick?: () => void;
     isEditing?: boolean;
   }

   export function LogoTile({ onClick, isEditing }: LogoTileProps) {
     const logo = useCanvasStore(state => state.assets.logo);
     const colors = useCanvasStore(state => state.assets.colors);
     const { scale, variant, background } = useCanvasStore(state => state.tileSettings.logo);

     // Calculate adaptive background for 'auto' mode
     const { background: autoBackground } = useImageLuminance(logo);

     // Determine actual background color
     const bgColor =
       background === 'white' ? '#FFFFFF' :
       background === 'dark' ? '#111111' :
       background === 'primary' ? (colors[0] || '#2563EB') :
       background === 'auto' ? (autoBackground === 'dark' ? '#111111' : '#FFFFFF') :
       '#FFFFFF';

     // CSS filter for variant
     const getVariantFilter = () => {
       switch (variant) {
         case 'dark':
           return 'brightness(0) saturate(100%)';
         case 'light':
           return 'brightness(0) saturate(100%) invert(1)';
         default:
           return 'none';
       }
     };

     return (
       <div
         className={`tile tile-logo ${isEditing ? 'editing' : ''}`}
         onClick={onClick}
         style={{ backgroundColor: bgColor }}
         role="button"
         tabIndex={0}
         aria-label="Logo tile - click to edit"
       >
         <div className="logo-container">
           {logo ? (
             <img
               src={logo}
               alt="Brand logo"
               className="logo-image"
               style={{
                 transform: `scale(${scale / 100})`,
                 filter: getVariantFilter(),
               }}
             />
           ) : (
             <div className="logo-placeholder">
               <span className="placeholder-text">No logo</span>
             </div>
           )}
         </div>
       </div>
     );
   }
   ```

2. Add CSS (in component or global):
   ```css
   .tile-logo {
     position: relative;
     overflow: hidden;
     transition: background-color 200ms ease-out;
   }

   .logo-container {
     display: flex;
     align-items: center;
     justify-content: center;
     width: 100%;
     height: 100%;
     padding: 24px; /* LOGO-01: minimum 24px padding */
   }

   .logo-image {
     max-width: calc(100% - 48px);
     max-height: calc(100% - 48px);
     object-fit: contain;
     object-position: center;
     transform-origin: center;
     transition: transform 120ms ease-out, filter 120ms ease-out;
   }

   .logo-placeholder {
     display: flex;
     align-items: center;
     justify-content: center;
     width: 80px;
     height: 80px;
     border: 2px dashed #ccc;
     border-radius: 8px;
     color: #888;
     font-size: 13px;
   }
   ```
  </action>
  <verify>
    Render LogoTile in App.tsx with a test logo URL
    Logo displays centered with padding
    Background changes based on tileSettings.logo.background
    When background is 'auto', background adapts based on luminance
  </verify>
  <done>
    LogoTile displays logo centered with 24px padding, adaptive background via useImageLuminance when set to 'auto', variant filters, scale transform
  </done>
</task>

<task type="auto">
  <name>Task 3: Create LogoEditPanel with all controls</name>
  <files>
    src/components/panels/LogoEditPanel.tsx
    src/components/panels/index.ts
  </files>
  <action>
1. Create `src/components/panels/LogoEditPanel.tsx`:
   ```typescript
   import { useCallback } from 'react';
   import { useCanvasStore } from '@/state/canvasState';
   import { Slider, ToggleGroup } from '@/components/controls';

   interface LogoEditPanelProps {
     onClose: () => void;
   }

   export function LogoEditPanel({ onClose }: LogoEditPanelProps) {
     const { scale, variant, background } = useCanvasStore(state => state.tileSettings.logo);
     const setLogoScale = useCanvasStore(state => state.setLogoScale);
     const setLogoVariant = useCanvasStore(state => state.setLogoVariant);
     const setLogoBackground = useCanvasStore(state => state.setLogoBackground);
     const setAssets = useCanvasStore(state => state.setAssets);

     // File upload handler
     const handleFileUpload = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {
       const file = e.target.files?.[0];
       if (!file) return;

       // Validate file type
       const validTypes = ['image/svg+xml', 'image/png', 'image/jpeg', 'image/jpg'];
       if (!validTypes.includes(file.type)) {
         alert('Please upload an SVG, PNG, or JPG file');
         return;
       }

       // Read as data URI
       const reader = new FileReader();
       reader.onload = (event) => {
         const dataUri = event.target?.result as string;
         setAssets({ logo: dataUri, logoSource: 'default' });
       };
       reader.readAsDataURL(file);
     }, [setAssets]);

     return (
       <div className="edit-panel logo-edit-panel">
         <div className="edit-panel-header">
           <h3>Logo Options</h3>
           <button
             type="button"
             className="edit-panel-close"
             onClick={onClose}
             aria-label="Close panel"
           >
             Ã—
           </button>
         </div>

         <div className="edit-panel-content">
           {/* Upload */}
           <div className="control-group">
             <label className="control-label">Upload Logo</label>
             <input
               type="file"
               accept=".svg,.png,.jpg,.jpeg"
               onChange={handleFileUpload}
               className="file-input"
             />
             <p className="control-hint">SVG, PNG, or JPG</p>
           </div>

           {/* Scale slider */}
           <Slider
             value={scale}
             min={40}
             max={100}
             step={5}
             label="Scale"
             onChange={setLogoScale}
             formatValue={(v) => `${v}%`}
           />

           {/* Variant toggle */}
           <ToggleGroup
             label="Variant"
             value={variant}
             options={[
               { value: 'original', label: 'Original' },
               { value: 'dark', label: 'Dark' },
               { value: 'light', label: 'Light' },
             ]}
             onChange={setLogoVariant}
           />

           {/* Background toggle with Auto option */}
           <ToggleGroup
             label="Background"
             value={background}
             options={[
               { value: 'auto', label: 'Auto' },
               { value: 'white', label: 'White' },
               { value: 'dark', label: 'Dark' },
               { value: 'primary', label: 'Brand' },
             ]}
             onChange={setLogoBackground}
           />
         </div>
       </div>
     );
   }
   ```

2. Add CSS for edit panel:
   ```css
   .edit-panel {
     background: white;
     border-radius: 12px;
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
     padding: 20px;
     min-width: 280px;
   }

   .edit-panel-header {
     display: flex;
     justify-content: space-between;
     align-items: center;
     margin-bottom: 20px;
     padding-bottom: 12px;
     border-bottom: 1px solid #e0e0e0;
   }

   .edit-panel-header h3 {
     margin: 0;
     font-size: 16px;
     font-weight: 600;
   }

   .edit-panel-close {
     width: 28px;
     height: 28px;
     border: none;
     background: #f0f0f0;
     border-radius: 50%;
     font-size: 18px;
     cursor: pointer;
     display: flex;
     align-items: center;
     justify-content: center;
     color: #666;
     transition: background 150ms;
   }

   .edit-panel-close:hover {
     background: #e0e0e0;
   }

   .edit-panel-content {
     display: flex;
     flex-direction: column;
     gap: 20px;
   }

   .control-group {
     display: flex;
     flex-direction: column;
     gap: 8px;
   }

   .control-label {
     font-size: 14px;
     color: #555;
   }

   .control-hint {
     font-size: 12px;
     color: #888;
     margin: 0;
   }

   .file-input {
     padding: 8px;
     border: 1px dashed #ccc;
     border-radius: 6px;
     cursor: pointer;
   }
   ```

3. Create `src/components/panels/index.ts`:
   ```typescript
   export { LogoEditPanel } from './LogoEditPanel';
   ```
  </action>
  <verify>
    Render LogoEditPanel in App.tsx with onClose console.log
    Upload file, verify logo changes in store
    Adjust scale slider, verify scale updates with single undo step
    Toggle variant and background, verify changes apply
    Toggle background to 'Auto', verify tile background adapts to logo luminance
  </verify>
  <done>
    LogoEditPanel with file upload (LOGO-03), scale slider (LOGO-05), variant toggle (LOGO-04), background toggle with Auto option (LOGO-02, LOGO-06), all wired to state
  </done>
</task>

</tasks>

<verification>
1. LogoTile renders with logo centered and 24px padding (LOGO-01)
2. Background adapts to luminance when set to 'auto' (LOGO-02)
3. File upload accepts SVG, PNG, JPG and updates logo in state (LOGO-03)
4. Variant toggle applies filter: original=none, dark=black, light=white (LOGO-04)
5. Scale slider adjusts logo size 40-100% (LOGO-05)
6. Background toggle switches between auto, white, #111, brand primary (LOGO-06)
7. Slider creates single undo step per drag (not multiple)
</verification>

<success_criteria>
- LOGO-01: Logo displays centered with minimum 24px padding
- LOGO-02: Logo background auto-adapts based on luminance when 'auto' selected
- LOGO-03: User can upload replacement logo (SVG, PNG, JPG)
- LOGO-04: User can toggle between Original, Dark, Light variants
- LOGO-05: User can adjust logo scale (40-100%)
- LOGO-06: User can toggle tile background (auto, white, dark, brand primary)
</success_criteria>

<output>
After completion, create `.planning/phases/03-logo-typography-tiles/03-02-SUMMARY.md`
</output>
