---
phase: 09-responsive-bento-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/layout.ts
  - src/config/layoutPresets.ts
  - src/store/useLayoutStore.ts
  - src/hooks/useViewportHeight.ts
  - src/hooks/useBreakpoint.ts
autonomous: true

must_haves:
  truths:
    - "Layout presets are defined with grid-template-areas configurations"
    - "Breakpoint state is tracked in Zustand store"
    - "Viewport height hook returns dvh-safe value"
  artifacts:
    - path: "src/types/layout.ts"
      provides: "TypeScript types for layout system"
      exports: ["LayoutPreset", "BreakpointName", "DensityMode", "TileSpan"]
    - path: "src/config/layoutPresets.ts"
      provides: "Grid preset configurations"
      exports: ["LAYOUT_PRESETS", "BREAKPOINTS"]
    - path: "src/store/useLayoutStore.ts"
      provides: "Layout state management"
      exports: ["useLayoutStore"]
    - path: "src/hooks/useViewportHeight.ts"
      provides: "Viewport height with dvh support"
      exports: ["useViewportHeight"]
    - path: "src/hooks/useBreakpoint.ts"
      provides: "Breakpoint detection hook"
      exports: ["useBreakpoint"]
  key_links:
    - from: "src/hooks/useBreakpoint.ts"
      to: "src/store/useLayoutStore.ts"
      via: "setBreakpoint action"
      pattern: "setBreakpoint\\("
---

<objective>
Create layout infrastructure: TypeScript types, grid presets, layout store, and viewport/breakpoint hooks.

Purpose: Establish foundation for responsive bento grid with deterministic layouts and proper viewport handling.
Output: Types, presets, Zustand store, and hooks ready for grid component.
</objective>

<execution_context>
@/Users/sannagranqvist/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sannagranqvist/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-responsive-bento-layout/09-RESEARCH.md
@src/store/useBrandStore.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create layout types and grid preset configurations</name>
  <files>src/types/layout.ts, src/config/layoutPresets.ts</files>
  <action>
Create TypeScript types for the layout system:

**src/types/layout.ts:**
```typescript
export type BreakpointName = 'mobile' | 'tablet' | 'desktop';
export type DensityMode = 'cozy' | 'dense';
export type LayoutPresetName = 'balanced' | 'heroLeft' | 'heroCenter' | 'stacked';

export interface TileSpan {
  colSpan: number;
  rowSpan: number;
}

export interface BreakpointSpans {
  mobile: TileSpan;
  tablet: TileSpan;
  desktop: TileSpan;
}

export interface LayoutPreset {
  name: LayoutPresetName;
  columns: { mobile: number; tablet: number; desktop: number };
  rows: { mobile: number; tablet: number; desktop: number };
  gap: { cozy: number; dense: number };
  rowHeight: { cozy: number; dense: number };
  tileSpans: Record<string, BreakpointSpans>;
}

export interface LayoutState {
  breakpoint: BreakpointName;
  preset: LayoutPresetName;
  density: DensityMode;
  debugMode: boolean;
}
```

**src/config/layoutPresets.ts:**
Define 4 layout presets (balanced, heroLeft, heroCenter, stacked) with:
- columns: mobile=2, tablet=4, desktop=4
- rows: mobile=auto (computed), tablet/desktop=3
- gap: cozy=16px, dense=8px
- rowHeight: cozy=280px, dense=200px
- tileSpans for each tile type per breakpoint

Define BREAKPOINTS object:
```typescript
export const BREAKPOINTS = {
  mobile: 0,
  tablet: 768,
  desktop: 1024,
} as const;
```

Tile types to define spans for: hero, logo, colors, primaryType, secondaryType, imagery, uiPreview, editorial, product, utility

For balanced preset desktop:
- hero: 2x2, logo: 1x1, colors: 1x1
- primaryType: 1x1, secondaryType: 1x1
- imagery: 1x2, uiPreview: 4x1 (full width bottom row)

Mobile collapses to 2 columns with adjusted spans.
  </action>
  <verify>
Check TypeScript types compile: `npx tsc --noEmit src/types/layout.ts src/config/layoutPresets.ts`
  </verify>
  <done>
Layout types and 4 preset configurations created with tile spans per breakpoint.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create layout Zustand store</name>
  <files>src/store/useLayoutStore.ts</files>
  <action>
Create Zustand store for layout state:

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import type { BreakpointName, DensityMode, LayoutPresetName } from '../types/layout';

interface LayoutStore {
  // State
  breakpoint: BreakpointName;
  preset: LayoutPresetName;
  density: DensityMode;
  debugMode: boolean;

  // Actions
  setBreakpoint: (bp: BreakpointName) => void;
  setPreset: (preset: LayoutPresetName) => void;
  setDensity: (density: DensityMode) => void;
  toggleDebug: () => void;
}

export const useLayoutStore = create<LayoutStore>()(
  persist(
    (set) => ({
      breakpoint: 'desktop',
      preset: 'balanced',
      density: 'cozy',
      debugMode: false,

      setBreakpoint: (breakpoint) => set({ breakpoint }),
      setPreset: (preset) => set({ preset }),
      setDensity: (density) => set({ density }),
      toggleDebug: () => set((state) => ({ debugMode: !state.debugMode })),
    }),
    {
      name: 'layout-store',
      partialize: (state) => ({
        preset: state.preset,
        density: state.density,
        // Don't persist breakpoint (computed from window) or debugMode
      }),
    }
  )
);
```

Do NOT persist breakpoint (it's computed from window width). Do NOT persist debugMode (dev feature).
  </action>
  <verify>
Import store in a test file and verify it exports correctly: `npx tsc --noEmit src/store/useLayoutStore.ts`
  </verify>
  <done>
Layout store created with persist middleware for preset and density only.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create viewport height and breakpoint hooks</name>
  <files>src/hooks/useViewportHeight.ts, src/hooks/useBreakpoint.ts</files>
  <action>
**src/hooks/useViewportHeight.ts:**
Create hook that returns CSS value for 100dvh with vh fallback:

```typescript
import { useEffect, useState } from 'react';

export const useViewportHeight = (): string => {
  const [vh, setVh] = useState('100vh');

  useEffect(() => {
    // Check if dvh is supported
    const supportsDvh = CSS.supports('height', '100dvh');

    if (supportsDvh) {
      setVh('100dvh');
    } else {
      // Fallback: set CSS custom property for older browsers
      const updateVh = () => {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
      };

      updateVh();
      window.addEventListener('resize', updateVh);
      return () => window.removeEventListener('resize', updateVh);
    }
  }, []);

  return vh;
};

// Also export a CSS class string for use in Tailwind
export const getViewportHeightClass = (): string => {
  return 'h-[100dvh] supports-[height:100dvh]:h-dvh';
};
```

**src/hooks/useBreakpoint.ts:**
Create hook that detects breakpoint and updates Zustand store:

```typescript
import { useEffect } from 'react';
import { useLayoutStore } from '../store/useLayoutStore';
import { BREAKPOINTS } from '../config/layoutPresets';
import type { BreakpointName } from '../types/layout';

export const useBreakpoint = (): BreakpointName => {
  const breakpoint = useLayoutStore((s) => s.breakpoint);
  const setBreakpoint = useLayoutStore((s) => s.setBreakpoint);

  useEffect(() => {
    let timeoutId: ReturnType<typeof setTimeout>;

    const updateBreakpoint = () => {
      const width = window.innerWidth;
      let newBreakpoint: BreakpointName = 'mobile';

      if (width >= BREAKPOINTS.desktop) {
        newBreakpoint = 'desktop';
      } else if (width >= BREAKPOINTS.tablet) {
        newBreakpoint = 'tablet';
      }

      setBreakpoint(newBreakpoint);
    };

    // Initial check
    updateBreakpoint();

    // Debounced resize handler (100ms)
    const handleResize = () => {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(updateBreakpoint, 100);
    };

    window.addEventListener('resize', handleResize);
    return () => {
      window.removeEventListener('resize', handleResize);
      clearTimeout(timeoutId);
    };
  }, [setBreakpoint]);

  return breakpoint;
};
```

Use 100ms debounce as recommended in research to prevent excessive updates.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit src/hooks/useViewportHeight.ts src/hooks/useBreakpoint.ts`
  </verify>
  <done>
Viewport height hook with dvh/vh fallback and breakpoint hook with debounced resize created.
  </done>
</task>

</tasks>

<verification>
1. All TypeScript files compile without errors
2. Layout presets define 4 named configurations
3. Store exports all required actions
4. Hooks are properly typed
</verification>

<success_criteria>
- src/types/layout.ts exports all layout types
- src/config/layoutPresets.ts exports LAYOUT_PRESETS with 4 presets and BREAKPOINTS
- src/store/useLayoutStore.ts exports useLayoutStore with breakpoint, preset, density, debugMode
- src/hooks/useViewportHeight.ts exports useViewportHeight hook
- src/hooks/useBreakpoint.ts exports useBreakpoint hook that updates store
</success_criteria>

<output>
After completion, create `.planning/phases/09-responsive-bento-layout/09-01-SUMMARY.md`
</output>
