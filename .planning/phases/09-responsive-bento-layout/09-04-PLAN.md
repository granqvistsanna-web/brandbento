---
phase: 09-responsive-bento-layout
plan: 04
type: execute
wave: 3
depends_on: ["09-02", "09-03"]
files_modified:
  - src/components/DebugGrid.tsx
  - src/components/BentoGrid.tsx
  - src/components/ControlPanel.jsx
autonomous: true

must_haves:
  truths:
    - "Debug mode shows grid cell boundaries and tile IDs"
    - "Density parameter works correctly (cozy vs dense modes)"
    - "User can toggle debug mode and density from UI"
  artifacts:
    - path: "src/components/DebugGrid.tsx"
      provides: "Debug overlay showing grid structure"
      exports: ["DebugGrid"]
      min_lines: 30
  key_links:
    - from: "src/components/DebugGrid.tsx"
      to: "src/store/useLayoutStore.ts"
      via: "useLayoutStore for debugMode"
      pattern: "useLayoutStore"
    - from: "src/components/ControlPanel.jsx"
      to: "src/store/useLayoutStore.ts"
      via: "density and debug toggles"
      pattern: "useLayoutStore"
---

<objective>
Add debug mode overlay and density controls to complete the responsive layout system.

Purpose: Enable developers to visualize grid structure and users to choose layout density.
Output: DebugGrid overlay component and density/debug controls in toolbar.
</objective>

<execution_context>
@/Users/sannagranqvist/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sannagranqvist/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-responsive-bento-layout/09-RESEARCH.md
@.planning/phases/09-responsive-bento-layout/09-02-SUMMARY.md
@.planning/phases/09-responsive-bento-layout/09-03-SUMMARY.md
@src/components/BentoGrid.tsx
@src/components/ControlPanel.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DebugGrid overlay component</name>
  <files>src/components/DebugGrid.tsx</files>
  <action>
Create debug overlay that shows grid cell boundaries:

```typescript
import React from 'react';
import { useLayoutStore } from '../store/useLayoutStore';
import { LAYOUT_PRESETS } from '../config/layoutPresets';

export const DebugGrid = () => {
  const debugMode = useLayoutStore((s) => s.debugMode);
  const preset = useLayoutStore((s) => s.preset);
  const breakpoint = useLayoutStore((s) => s.breakpoint);
  const density = useLayoutStore((s) => s.density);

  if (!debugMode) return null;

  const config = LAYOUT_PRESETS[preset];
  const columns = config.columns[breakpoint];
  const rows = config.rows[breakpoint];
  const gap = config.gap[density];
  const rowHeight = config.rowHeight[density];

  const totalCells = columns * rows;

  return (
    <div
      className="absolute inset-0 pointer-events-none z-50"
      style={{
        display: 'grid',
        gridTemplateColumns: `repeat(${columns}, 1fr)`,
        gridTemplateRows: `repeat(${rows}, ${rowHeight}px)`,
        gap: `${gap}px`,
        padding: density === 'cozy' ? '16px' : '8px',
      }}
    >
      {Array.from({ length: totalCells }).map((_, i) => {
        const col = (i % columns) + 1;
        const row = Math.floor(i / columns) + 1;
        return (
          <div
            key={i}
            className="border-2 border-dashed border-pink-500/40 bg-pink-500/5 rounded-lg flex flex-col items-center justify-center"
          >
            <span className="text-[10px] font-mono text-pink-600 font-bold">
              {i + 1}
            </span>
            <span className="text-[8px] font-mono text-pink-500/80">
              c{col} r{row}
            </span>
          </div>
        );
      })}

      {/* Debug info panel */}
      <div className="absolute top-2 right-2 bg-pink-600 text-white text-[10px] font-mono px-2 py-1 rounded shadow-lg">
        <div>{preset} | {breakpoint}</div>
        <div>{columns}x{rows} | {density}</div>
      </div>
    </div>
  );
};

export default DebugGrid;
```

Features:
1. Shows numbered grid cells with column/row position
2. Dashed pink borders visible but not intrusive
3. Info panel shows current preset, breakpoint, grid size, density
4. Only renders when debugMode is true
5. pointer-events-none so it doesn't block interaction
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit src/components/DebugGrid.tsx`
  </verify>
  <done>
DebugGrid overlay component created with grid cell visualization.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate DebugGrid into BentoGrid</name>
  <files>src/components/BentoGrid.tsx</files>
  <action>
Update BentoGrid to include DebugGrid overlay:

1. Import DebugGrid:
```typescript
import { DebugGrid } from './DebugGrid';
```

2. Wrap the grid in a relative container and add DebugGrid:

Change from:
```typescript
return (
  <div
    className={cn(
      'h-[100dvh] max-h-[100dvh]',
      // ... other classes
    )}
    style={{ ... }}
  >
    {children}
  </div>
);
```

To:
```typescript
return (
  <div className="relative h-[100dvh] max-h-[100dvh]">
    <div
      className={cn(
        'h-full w-full',
        'pb-[env(safe-area-inset-bottom)]',
        'grid',
        density === 'cozy' ? 'p-4' : 'p-2',
        'overflow-hidden',
        className
      )}
      style={{
        gridTemplateColumns: `repeat(${columns}, 1fr)`,
        gridTemplateRows: `repeat(${rows}, ${rowHeight}px)`,
        gap: `${gap}px`,
      }}
    >
      {children}
    </div>
    <DebugGrid />
  </div>
);
```

This puts DebugGrid as a sibling that overlays the grid.
  </action>
  <verify>
Run dev server, toggle debug mode (will need controls in next task).
Grid overlay should appear showing cell boundaries.
  </verify>
  <done>
DebugGrid integrated into BentoGrid as overlay.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add density and debug controls to ControlPanel</name>
  <files>src/components/ControlPanel.jsx</files>
  <action>
Add layout controls to the ControlPanel:

1. Import useLayoutStore at top:
```javascript
import { useLayoutStore } from '../store/useLayoutStore';
```

2. In the component, get layout state and actions:
```javascript
const { density, debugMode, preset, setDensity, toggleDebug, setPreset } = useLayoutStore();
```

3. Add a "Layout" section in the control panel (find appropriate location, likely near theme controls):

```jsx
{/* Layout Controls Section */}
<div className="border-t border-neutral-200 dark:border-neutral-700 pt-4 mt-4">
  <h3 className="text-xs font-semibold uppercase tracking-wider text-neutral-500 dark:text-neutral-400 mb-3">
    Layout
  </h3>

  {/* Density Toggle */}
  <div className="flex items-center justify-between mb-3">
    <span className="text-sm text-neutral-700 dark:text-neutral-300">Density</span>
    <div className="flex gap-1 bg-neutral-100 dark:bg-neutral-800 p-1 rounded-lg">
      <button
        onClick={() => setDensity('cozy')}
        className={`px-3 py-1 text-xs rounded-md transition-colors ${
          density === 'cozy'
            ? 'bg-white dark:bg-neutral-700 shadow-sm text-neutral-900 dark:text-white'
            : 'text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white'
        }`}
      >
        Cozy
      </button>
      <button
        onClick={() => setDensity('dense')}
        className={`px-3 py-1 text-xs rounded-md transition-colors ${
          density === 'dense'
            ? 'bg-white dark:bg-neutral-700 shadow-sm text-neutral-900 dark:text-white'
            : 'text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-white'
        }`}
      >
        Dense
      </button>
    </div>
  </div>

  {/* Preset Selector */}
  <div className="flex items-center justify-between mb-3">
    <span className="text-sm text-neutral-700 dark:text-neutral-300">Preset</span>
    <select
      value={preset}
      onChange={(e) => setPreset(e.target.value)}
      className="text-xs bg-neutral-100 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-lg px-2 py-1.5 text-neutral-700 dark:text-neutral-300"
    >
      <option value="balanced">Balanced</option>
      <option value="heroLeft">Hero Left</option>
      <option value="heroCenter">Hero Center</option>
      <option value="stacked">Stacked</option>
    </select>
  </div>

  {/* Debug Mode Toggle */}
  <div className="flex items-center justify-between">
    <span className="text-sm text-neutral-700 dark:text-neutral-300">Debug Grid</span>
    <button
      onClick={toggleDebug}
      className={`w-10 h-5 rounded-full transition-colors relative ${
        debugMode ? 'bg-pink-500' : 'bg-neutral-300 dark:bg-neutral-600'
      }`}
    >
      <span
        className={`absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform ${
          debugMode ? 'translate-x-5' : ''
        }`}
      />
    </button>
  </div>
</div>
```

This adds:
1. Cozy/Dense toggle buttons for density
2. Dropdown for preset selection
3. Toggle switch for debug mode
  </action>
  <verify>
Run dev server:
1. Layout section appears in control panel
2. Density toggle switches between cozy/dense (grid gap and row height change)
3. Preset dropdown changes grid configuration
4. Debug toggle shows/hides pink grid overlay
  </verify>
  <done>
Layout controls added to ControlPanel with density, preset, and debug toggles.
  </done>
</task>

</tasks>

<verification>
1. DebugGrid shows grid cell boundaries when enabled
2. Debug info panel shows current configuration
3. Density toggle changes grid gap and row height
4. Preset selector changes grid layout
5. All controls work in both light and dark mode
</verification>

<success_criteria>
- DebugGrid.tsx renders cell boundaries when debugMode is true
- Debug info shows preset, breakpoint, grid size, density
- Cozy density uses 16px gap and 280px rows
- Dense density uses 8px gap and 200px rows
- Preset selector changes layout configuration
- Controls styled consistently with existing UI
</success_criteria>

<output>
After completion, create `.planning/phases/09-responsive-bento-layout/09-04-SUMMARY.md`
</output>
