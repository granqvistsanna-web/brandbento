---
phase: 06-workflows
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/hooks/useKeyboardShortcuts.ts
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Cmd+Z undoes the last action"
    - "Cmd+Shift+Z redoes the last undone action"
    - "Browser default undo/redo is prevented"
  artifacts:
    - path: "src/hooks/useKeyboardShortcuts.ts"
      provides: "Keyboard shortcut handler for undo/redo"
      exports: ["useKeyboardShortcuts"]
    - path: "package.json"
      contains: "html-to-image"
    - path: "package.json"
      contains: "react-hot-toast"
  key_links:
    - from: "src/hooks/useKeyboardShortcuts.ts"
      to: "useBrandStore"
      via: "undo/redo actions"
      pattern: "undo\\(\\)|redo\\(\\)"
    - from: "src/App.tsx"
      to: "src/hooks/useKeyboardShortcuts.ts"
      via: "hook invocation"
      pattern: "useKeyboardShortcuts"
---

<objective>
Install dependencies and create keyboard shortcuts hook for undo/redo workflow actions.

Purpose: Foundation for all Phase 6 workflow features - installs html-to-image for export, react-hot-toast for notifications, and wires Cmd+Z/Cmd+Shift+Z shortcuts.

Output: Working keyboard shortcuts, installed dependencies ready for export and share features.
</objective>

<execution_context>
@/Users/sannagranqvist/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sannagranqvist/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-workflows/06-RESEARCH.md

Key context from research:
- Use html-to-image@1.11.13 (locked version, newer has bugs)
- Use react-hot-toast (5KB, simple API)
- useBrandStore already has undo/redo actions that check history.past.length / history.future.length
- Must prevent default browser Cmd+Z behavior with e.preventDefault()
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install workflow dependencies</name>
  <files>package.json</files>
  <action>
Install html-to-image and react-hot-toast:

```bash
npm install html-to-image@1.11.13 react-hot-toast
```

IMPORTANT: Lock html-to-image to 1.11.13 - newer versions have export bugs (see 06-RESEARCH.md pitfall #1).
  </action>
  <verify>Run `npm list html-to-image react-hot-toast` - should show 1.11.13 and latest respectively</verify>
  <done>Both packages appear in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create useKeyboardShortcuts hook</name>
  <files>src/hooks/useKeyboardShortcuts.ts</files>
  <action>
Create a hook that listens for keyboard shortcuts and triggers undo/redo:

```typescript
import { useEffect } from 'react';
import { useBrandStore } from '../store/useBrandStore';

export function useKeyboardShortcuts() {
  const undo = useBrandStore((state) => state.undo);
  const redo = useBrandStore((state) => state.redo);
  const history = useBrandStore((state) => state.history);

  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      // Check for Cmd (Mac) or Ctrl (Windows/Linux)
      const isMod = e.metaKey || e.ctrlKey;

      if (isMod && e.key === 'z') {
        e.preventDefault(); // CRITICAL: Prevent browser default undo

        if (e.shiftKey) {
          // Cmd+Shift+Z = Redo
          if (history.future.length > 0) {
            redo();
          }
        } else {
          // Cmd+Z = Undo
          if (history.past.length > 0) {
            undo();
          }
        }
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [undo, redo, history.past.length, history.future.length]);
}
```

The hook:
1. Gets undo/redo actions from useBrandStore
2. Listens for keydown events
3. Prevents default browser behavior
4. Checks canUndo/canRedo before calling actions
  </action>
  <verify>File exists and exports useKeyboardShortcuts function</verify>
  <done>Hook created with proper event handling and cleanup</done>
</task>

<task type="auto">
  <name>Task 3: Wire keyboard shortcuts in App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Import and invoke the useKeyboardShortcuts hook in App.tsx:

1. Add import at top:
```typescript
import { useKeyboardShortcuts } from './hooks/useKeyboardShortcuts';
```

2. Call the hook inside the App component (near other hooks):
```typescript
export default function App() {
  useTheme();
  useKeyboardShortcuts(); // Add this line

  const { undo, redo, history, loadRandomTemplate } = useBrandStore();
  // ... rest of component
}
```

This ensures keyboard shortcuts are active whenever the app is rendered.
  </action>
  <verify>Run the dev server, press Cmd+Z after making a change - should undo</verify>
  <done>Keyboard shortcuts work in the application</done>
</task>

</tasks>

<verification>
1. `npm list html-to-image` shows 1.11.13
2. `npm list react-hot-toast` shows installed version
3. Press Cmd+Z after changing a color/font - change is undone
4. Press Cmd+Shift+Z - change is redone
5. Pressing Cmd+Z in a text field doesn't conflict (browser undo prevented)
</verification>

<success_criteria>
- [ ] html-to-image@1.11.13 installed
- [ ] react-hot-toast installed
- [ ] useKeyboardShortcuts hook exists and works
- [ ] Cmd+Z undoes last change
- [ ] Cmd+Shift+Z redoes undone change
- [ ] Browser default undo is prevented (no double-undo behavior)
</success_criteria>

<output>
After completion, create `.planning/phases/06-workflows/06-01-SUMMARY.md`
</output>
