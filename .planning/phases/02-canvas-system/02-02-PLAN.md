---
phase: 02-canvas-system
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/state/canvasState.ts
  - src/components/Tile.tsx
  - src/App.css
autonomous: true

must_haves:
  truths:
    - "Hovering a tile shows frosted glass overlay with label and edit icon"
    - "Clicking a tile sets it as the editing tile"
    - "When one tile is editing, all other tiles dim to 60% opacity"
    - "Clicking the editing tile again closes edit mode"
    - "State transitions animate at 200ms ease-out"
    - "Frosted glass uses backdrop-filter blur"
  artifacts:
    - path: "src/state/canvasState.ts"
      provides: "editingTileId state and setEditingTile action"
      contains: "editingTileId"
    - path: "src/components/Tile.tsx"
      provides: "Tile component with hover overlay and edit state"
      contains: "tile-overlay"
    - path: "src/App.css"
      provides: "Frosted glass overlay and dim styling"
      contains: "backdrop-filter"
  key_links:
    - from: "src/components/Tile.tsx"
      to: "src/state/canvasState.ts"
      via: "useCanvasStore subscription"
      pattern: "useCanvasStore.*editingTileId"
---

<objective>
Add tile hover states with frosted glass overlay and implement click-to-edit interaction with proper dimming of non-editing tiles.

Purpose: Interactive tiles are the core editing UX. Users need visual feedback (hover overlay) and clear editing context (other tiles dim) to understand what they're editing.

Output: Tiles that show frosted glass overlay on hover, respond to clicks to enter edit mode, and dim when another tile is being edited.
</objective>

<execution_context>
@/Users/sannagranqvist/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sannagranqvist/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-canvas-system/02-RESEARCH.md
@.planning/phases/02-canvas-system/02-01-SUMMARY.md
@src/state/canvasState.ts
@src/components/Tile.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add editing state to Zustand store</name>
  <files>src/state/canvasState.ts</files>
  <action>
Add `editingTileId` state and `setEditingTile` action to the canvas store.

Update the CanvasStore interface:
```typescript
interface CanvasStore extends CanvasState {
  // Existing state...
  extractionStage: ExtractionStage;
  extractionError: string | null;

  // Add editing state
  editingTileId: string | null;

  // Existing actions...
  setAssets: (assets: Partial<BrandAssets>) => void;
  setSourceUrl: (url: string | null) => void;
  setExtractionStage: (stage: ExtractionStage) => void;
  setExtractionError: (error: string | null) => void;
  reset: () => void;
  hydrate: () => void;

  // Add editing action
  setEditingTile: (tileId: string | null) => void;
}
```

Add to the store implementation:
```typescript
export const useCanvasStore = create<CanvasStore>()(
  subscribeWithSelector((set, get) => ({
    // Existing state...
    editingTileId: null,

    // Add action
    setEditingTile: (tileId) => set({ editingTileId: tileId }),

    // Existing actions remain unchanged...
  }))
);
```

Note: `editingTileId` is NOT persisted - it resets on page load. Do NOT add it to the persistence subscriber.
  </action>
  <verify>TypeScript compiles: `npm run build 2>&1 | head -20`. Check that editingTileId is in the store type.</verify>
  <done>editingTileId state and setEditingTile action available in store</done>
</task>

<task type="auto">
  <name>Task 2: Add frosted glass overlay and click handler to Tile component</name>
  <files>src/components/Tile.tsx</files>
  <action>
Refactor the base Tile component to:
1. Accept `id` prop for identification
2. Subscribe to editingTileId from store
3. Show frosted glass overlay on hover (only when not editing this tile)
4. Handle click to toggle editing
5. Apply dimmed class when another tile is editing

Update Tile component:
```tsx
import { useCanvasStore } from '@/state/canvasState';

interface TileProps {
  id: string;  // Add required id
  children: React.ReactNode;
  isLoading?: boolean;
  isDefault?: boolean;
  label: string;
  className?: string;
}

export function Tile({
  id,
  children,
  isLoading = false,
  isDefault = false,
  label,
  className = ''
}: TileProps) {
  const editingTileId = useCanvasStore((state) => state.editingTileId);
  const setEditingTile = useCanvasStore((state) => state.setEditingTile);

  const isEditing = editingTileId === id;
  const isDimmed = editingTileId !== null && !isEditing;

  const handleClick = () => {
    // Toggle: if already editing, close; otherwise open
    setEditingTile(isEditing ? null : id);
  };

  return (
    <div
      className={`tile ${isLoading ? 'tile-loading' : ''} ${isDimmed ? 'tile-dimmed' : ''} ${isEditing ? 'tile-editing' : ''} ${className}`}
      onClick={handleClick}
      style={{ opacity: isDimmed ? 0.6 : 1 }}
    >
      <div className="tile-header">
        <span className="tile-label">{label}</span>
        {isDefault && <span className="tile-status">default</span>}
      </div>
      <div className="tile-content">
        {!isLoading && children}
      </div>

      {/* Frosted glass overlay - only show on hover when not editing */}
      {!isEditing && !isLoading && (
        <div className="tile-overlay">
          <span className="tile-overlay-label">{label}</span>
          <span className="tile-overlay-icon">Edit</span>
        </div>
      )}
    </div>
  );
}
```

Update all tile variants (LogoTile, FontTile, ColorTile, ImageTile) to pass the `id` prop:
- LogoTile: `id="logo"`
- FontTile: `id={variant === 'primary' ? 'primary-font' : 'secondary-font'}`
- ColorTile: `id="colors"`
- ImageTile: `id="imagery"`

Also update UIPreviewTile to pass `id="ui-preview"`.
  </action>
  <verify>TypeScript compiles. Each tile component passes id prop correctly.</verify>
  <done>Tile components have id prop and subscribe to editing state</done>
</task>

<task type="auto">
  <name>Task 3: Add CSS for frosted glass overlay and transition animations</name>
  <files>src/App.css</files>
  <action>
Add CSS for frosted glass overlay, hover state, dimming, and transitions:

```css
/* ============================================
   Tile Interaction States
   ============================================ */

/* Base tile transitions */
.tile {
  /* Add to existing .tile rules */
  cursor: pointer;
  transition: opacity 200ms ease-out, box-shadow 200ms ease-out;
}

/* Remove the old hover opacity change */
.tile:hover {
  opacity: 1; /* Override any default hover */
}

/* Dimmed state when another tile is editing */
.tile-dimmed {
  pointer-events: none; /* Prevent interaction while dimmed */
}

/* Editing state */
.tile-editing {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.08);
  z-index: 10;
}

/* ============================================
   Frosted Glass Overlay
   ============================================ */

.tile-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  opacity: 0;
  transition: opacity 200ms ease-out;
  pointer-events: none;
  z-index: 5;
}

/* Show overlay on hover */
.tile:hover .tile-overlay {
  opacity: 1;
}

/* Frosted glass background */
.tile-overlay::before {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-radius: inherit;
}

/* Fallback for browsers without backdrop-filter */
@supports not (backdrop-filter: blur(8px)) {
  .tile-overlay::before {
    background: rgba(255, 255, 255, 0.92);
  }
}

/* Overlay content */
.tile-overlay-label {
  position: relative;
  z-index: 1;
  font-size: 13px;
  font-weight: var(--font-weight-medium);
  color: var(--gray-700);
}

.tile-overlay-icon {
  position: relative;
  z-index: 1;
  font-size: 12px;
  color: var(--gray-500);
  padding: var(--space-1) var(--space-3);
  background: var(--white);
  border: 1px solid var(--gray-200);
  border-radius: 4px;
}

/* Don't show overlay on loading tiles */
.tile-loading .tile-overlay {
  display: none;
}

/* Don't show overlay on UI Preview (it's not directly editable) */
.tile-ui-preview .tile-overlay {
  display: none;
}

.tile-ui-preview {
  cursor: default;
}
```

Also ensure the tile has `position: relative` for the overlay positioning (should already be there from existing styles).
  </action>
  <verify>Run `npm run dev`:
1. Hover over any tile - frosted glass overlay appears with label and "Edit" button
2. Click a tile - it becomes "editing" (elevated shadow)
3. Other tiles dim to 60%
4. Click editing tile again - closes edit mode
5. Transitions are smooth (no flickering)</verify>
  <done>Frosted glass overlay, hover states, and dimming work correctly</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Hover behavior:**
   - Hover any tile (except UI Preview) - frosted glass overlay appears
   - Overlay shows tile label and "Edit" text
   - Overlay fades in/out smoothly (200ms)

2. **Click behavior:**
   - Click tile - becomes editing (elevated shadow)
   - Other tiles dim to 60% opacity
   - Click editing tile again - closes edit mode
   - Dimmed tiles have pointer-events: none

3. **Edge cases:**
   - UI Preview tile does NOT show overlay (not directly editable)
   - Loading tiles do NOT show overlay
   - Only one tile can be editing at a time

4. **Technical:**
   - `npm run build` completes without errors
   - No console errors in browser
   - Backdrop-filter works in Chrome, Safari, Firefox
</verification>

<success_criteria>
- Frosted glass overlay appears on tile hover with label and edit icon
- Clicking a tile enters edit mode (elevated shadow, others dim)
- Clicking again exits edit mode
- All transitions are 200ms ease-out with no flickering
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-canvas-system/02-02-SUMMARY.md`
</output>
