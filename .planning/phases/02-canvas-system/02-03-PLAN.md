---
phase: 02-canvas-system
plan: 03
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - src/components/Tile.tsx
  - src/components/EditPanel.tsx
  - src/App.css
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "User can Tab through tiles in reading order (left-to-right, top-to-bottom)"
    - "Pressing Enter on a focused tile opens its edit panel"
    - "Pressing Escape closes the currently open edit panel"
    - "Focused tiles have a 2px solid outline with 2px offset"
    - "Edit panel appears inline within the tile when editing"
    - "Only one edit panel can be open at a time"
  artifacts:
    - path: "src/components/Tile.tsx"
      provides: "Keyboard event handlers for Enter/Escape"
      contains: "onKeyDown"
    - path: "src/components/EditPanel.tsx"
      provides: "Base edit panel component with close button"
      exports: ["EditPanel"]
    - path: "src/App.css"
      provides: "Focus-visible styling and edit panel layout"
      contains: "focus-visible"
  key_links:
    - from: "src/components/Tile.tsx"
      to: "src/components/EditPanel.tsx"
      via: "conditional render when editing"
      pattern: "isEditing.*EditPanel"
---

<objective>
Implement keyboard navigation for tiles and create a base EditPanel component that renders inline when a tile is being edited.

Purpose: Keyboard accessibility is essential (WCAG requirement). The inline edit panel pattern keeps context visible while editing, supporting the "system view" core value.

Output: Tab-navigable tiles with Enter/Escape keyboard support and a placeholder edit panel that appears inline when editing.
</objective>

<execution_context>
@/Users/sannagranqvist/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sannagranqvist/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-canvas-system/02-RESEARCH.md
@.planning/phases/02-canvas-system/02-02-SUMMARY.md
@src/components/Tile.tsx
@src/App.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add keyboard navigation to Tile component</name>
  <files>src/components/Tile.tsx</files>
  <action>
Update the Tile component to support keyboard navigation:

1. Add `tabIndex={0}` for keyboard focusability
2. Add `role="button"` for screen reader semantics
3. Add `aria-label` describing the tile and its action
4. Add `aria-pressed` for toggle state
5. Add `onKeyDown` handler for Enter/Space/Escape

Update the Tile component:
```tsx
export function Tile({
  id,
  children,
  isLoading = false,
  isDefault = false,
  label,
  className = ''
}: TileProps) {
  const editingTileId = useCanvasStore((state) => state.editingTileId);
  const setEditingTile = useCanvasStore((state) => state.setEditingTile);

  const isEditing = editingTileId === id;
  const isDimmed = editingTileId !== null && !isEditing;

  const handleClick = () => {
    setEditingTile(isEditing ? null : id);
  };

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault(); // Prevent space from scrolling
      setEditingTile(isEditing ? null : id);
    }
    if (e.key === 'Escape' && isEditing) {
      e.preventDefault();
      setEditingTile(null);
    }
  };

  return (
    <div
      className={`tile ${isLoading ? 'tile-loading' : ''} ${isDimmed ? 'tile-dimmed' : ''} ${isEditing ? 'tile-editing' : ''} ${className}`}
      onClick={handleClick}
      onKeyDown={handleKeyDown}
      tabIndex={isDimmed ? -1 : 0}  // Remove from tab order when dimmed
      role="button"
      aria-label={`${label} tile - ${isEditing ? 'click to close' : 'click to edit'}`}
      aria-pressed={isEditing}
      style={{ opacity: isDimmed ? 0.6 : 1 }}
    >
      {/* ... existing content ... */}
    </div>
  );
}
```

For UIPreviewTile, since it's not directly editable, use different keyboard handling:
- `tabIndex={0}` for focusability
- `role="region"` instead of button
- `aria-label="UI Preview - updates automatically as you change brand assets"`
- No onClick or onKeyDown handlers
  </action>
  <verify>Tab through the page - tiles receive focus in order. Press Enter on focused tile - opens edit mode. Press Escape - closes edit mode.</verify>
  <done>Tiles are keyboard navigable with Enter/Escape support</done>
</task>

<task type="auto">
  <name>Task 2: Create base EditPanel component</name>
  <files>src/components/EditPanel.tsx, src/components/index.ts</files>
  <action>
Create a base EditPanel component that will be used by all tile edit modes. For Phase 2, this is a placeholder that shows the tile name and a close button.

Create `src/components/EditPanel.tsx`:
```tsx
interface EditPanelProps {
  title: string;
  onClose: () => void;
  children?: React.ReactNode;
}

export function EditPanel({ title, onClose, children }: EditPanelProps) {
  return (
    <div className="edit-panel" role="dialog" aria-label={`Edit ${title}`}>
      <div className="edit-panel-header">
        <span className="edit-panel-title">{title}</span>
        <button
          className="edit-panel-close"
          onClick={(e) => {
            e.stopPropagation(); // Don't trigger tile click
            onClose();
          }}
          aria-label="Close edit panel"
        >
          Done
        </button>
      </div>
      <div className="edit-panel-content">
        {children || (
          <p className="edit-panel-placeholder">
            Edit controls coming in Phase 3
          </p>
        )}
      </div>
    </div>
  );
}
```

Update `src/components/index.ts` to export EditPanel:
```ts
export * from './Tile';
export * from './URLInput';
export * from './ExtractionOverlay';
export * from './tiles/UIPreviewTile';
export * from './EditPanel';
```
  </action>
  <verify>TypeScript compiles: `npm run build 2>&1 | head -20`</verify>
  <done>EditPanel component exists with header, close button, and content area</done>
</task>

<task type="auto">
  <name>Task 3: Render EditPanel inline and add focus-visible styles</name>
  <files>src/components/Tile.tsx, src/App.css</files>
  <action>
1. Update Tile to render EditPanel when editing
2. Add focus-visible CSS for keyboard navigation

Update Tile.tsx to import and render EditPanel:
```tsx
import { EditPanel } from './EditPanel';

// Inside Tile component, after the overlay div:
{isEditing && (
  <EditPanel
    title={label}
    onClose={() => setEditingTile(null)}
  />
)}
```

Add CSS for focus-visible and edit panel in App.css:
```css
/* ============================================
   Keyboard Focus Indicators
   ============================================ */

/* Remove default outline */
.tile:focus {
  outline: none;
}

/* Focus-visible: only show for keyboard navigation */
.tile:focus-visible {
  outline: 2px solid var(--gray-700);
  outline-offset: 2px;
}

/* ============================================
   Edit Panel (Inline)
   ============================================ */

.edit-panel {
  position: absolute;
  inset: 0;
  background: var(--white);
  padding: var(--space-4);
  display: flex;
  flex-direction: column;
  z-index: 20;
  border-radius: inherit;
}

.edit-panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-4);
  padding-bottom: var(--space-3);
  border-bottom: 1px solid var(--gray-100);
}

.edit-panel-title {
  font-size: 12px;
  font-weight: var(--font-weight-medium);
  color: var(--gray-700);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.edit-panel-close {
  padding: var(--space-1) var(--space-3);
  background: transparent;
  border: 1px solid var(--gray-200);
  font-family: var(--font-family);
  font-size: 12px;
  font-weight: var(--font-weight-medium);
  color: var(--gray-600);
  cursor: pointer;
  border-radius: 4px;
  transition: background 150ms ease;
}

.edit-panel-close:hover {
  background: var(--gray-50);
}

.edit-panel-close:focus-visible {
  outline: 2px solid var(--gray-700);
  outline-offset: 2px;
}

.edit-panel-content {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}

.edit-panel-placeholder {
  font-size: 13px;
  color: var(--gray-400);
  text-align: center;
}
```
  </action>
  <verify>Run `npm run dev`:
1. Tab to a tile - focus ring visible (2px solid)
2. Press Enter - edit panel opens inline
3. Edit panel shows title and "Done" button
4. Click Done or press Escape - panel closes
5. Focus ring only appears on keyboard navigation, not mouse click</verify>
  <done>Edit panel renders inline with proper focus management</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 2 canvas system with:
- 3x3 bento grid with correct tile placement
- UI Preview tile spanning full width
- Responsive layout (3 cols desktop, 2 cols tablet, 1 col mobile)
- Frosted glass hover overlays
- Click-to-edit with other tiles dimming
- Keyboard navigation (Tab/Enter/Escape)
- Inline edit panel placeholder
- Focus-visible styling
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open http://localhost:5173 (or shown port)

**Grid Layout:**
- Desktop (1200px+): Verify 3-column grid with Logo, Primary Type, Imagery (spans 2 rows), Colors, Secondary Type, UI Preview (full width)
- Resize to tablet (768-1024px): Verify 2-column layout
- Resize to mobile (<768px): Verify single column stack

**Hover States:**
- Hover any tile (except UI Preview): Frosted glass overlay appears with label and "Edit"
- Move away: Overlay fades out smoothly

**Edit Mode:**
- Click a tile: Edit panel appears inline, other tiles dim to 60%
- Click "Done" button: Panel closes
- Click outside (on dimmed area): Should NOT close panel (pointer-events disabled on dimmed tiles)

**Keyboard:**
- Tab through page: Tiles receive focus in reading order
- Focus ring: 2px solid outline appears ONLY on keyboard focus
- Press Enter on focused tile: Opens edit panel
- Press Escape: Closes edit panel
- Verify: Mouse clicks do NOT show focus ring

**Verify no regressions:**
- Enter a URL and extract brand (should still work)
- Tiles populate with extracted/default data
- State persists on refresh

Type "approved" if all checks pass, or describe any issues.
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete (before checkpoint):

1. **Keyboard navigation:**
   - Tab navigates through tiles in reading order
   - Enter/Space opens edit panel
   - Escape closes edit panel
   - Focus ring visible only on keyboard focus

2. **Edit panel:**
   - Appears inline within tile
   - Shows title and Done button
   - Done button closes panel
   - Click outside does not close (dimmed tiles have no pointer events)

3. **Technical:**
   - `npm run build` completes without errors
   - No console errors in browser
   - ARIA attributes present for screen readers
</verification>

<success_criteria>
- Tab navigates tiles in reading order (left-to-right, top-to-bottom)
- Enter opens edit panel, Escape closes it
- Focus ring is 2px solid with 2px offset, visible only on keyboard
- Edit panel renders inline with title and close button
- All Phase 2 success criteria from ROADMAP.md are met
</success_criteria>

<output>
After completion, create `.planning/phases/02-canvas-system/02-03-SUMMARY.md`
</output>
