---
phase: 05-system-view
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/tiles/UIPreviewMock.tsx
  - src/components/tiles/UIPreviewTile.tsx
  - src/App.css
autonomous: false

must_haves:
  truths:
    - "UI preview shows header with logo, nav, CTA button, text block, and card"
    - "Preview uses primary font for headings, secondary font for body"
    - "Preview uses current palette colors for background, text, CTA, and links"
    - "Preview shows scaled thumbnail from imagery tile"
    - "Preview updates within 100ms perceived delay when any asset changes"
  artifacts:
    - path: "src/components/tiles/UIPreviewMock.tsx"
      provides: "Generic interface mock component"
      exports: ["UIPreviewMock"]
      min_lines: 80
    - path: "src/components/tiles/UIPreviewTile.tsx"
      provides: "Reactive preview tile with selective subscriptions"
      exports: ["UIPreviewTile"]
      contains: "useShallow"
  key_links:
    - from: "src/components/tiles/UIPreviewTile.tsx"
      to: "src/state/canvasState.ts"
      via: "useShallow selector for brand assets"
      pattern: "useShallow.*assets"
    - from: "src/components/tiles/UIPreviewMock.tsx"
      to: "CSS custom properties"
      via: "inline styles using brand colors"
      pattern: "style=.*color"
---

<objective>
Build the reactive UI preview tile that shows all brand assets working together.

Purpose: Let users see typography, color, imagery, and logo as a unified system that updates live.
Output: UIPreviewMock component with interface elements, reactive UIPreviewTile with <100ms updates.
</objective>

<execution_context>
@/Users/sannagranqvist/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sannagranqvist/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-system-view/05-RESEARCH.md
@.planning/phases/05-system-view/05-01-SUMMARY.md

@src/state/canvasState.ts
@src/types/brand.ts
@src/components/tiles/UIPreviewTile.tsx
@src/hooks/useFontLoaderPreview.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UIPreviewMock component</name>
  <files>src/components/tiles/UIPreviewMock.tsx</files>
  <action>
Create a generic interface mock component that displays (UIPV-01):
- Header section with logo thumbnail and nav links
- Hero section with heading (primary font) and CTA button
- Text block with body text (secondary font)
- Card component with image thumbnail, title, and description

Props interface:
```typescript
interface UIPreviewMockProps {
  logo: string | null;
  heroImage: string | null;
  primaryFont: string;
  secondaryFont: string;
  colors: string[];  // [primary, accent, background, text, ...]
  isUpdating?: boolean;  // For transition class
}
```

Color mapping (UIPV-03):
- colors[0] = primary (CTA button background)
- colors[1] = accent (links)
- colors[2] = background (page background)
- colors[3] = text (body text)
- colors[4] = white/light (card background, button text)

Layout (responsive within tile):
```
┌──────────────────────────────────────────────┐
│ [logo]  Home  About  Contact    [CTA Button] │  Header
├──────────────────────────────────────────────┤
│                                              │
│     Welcome to Brand              [hero img] │  Hero
│     Discover your brand identity             │
│                                              │
├──────────────────────────────────────────────┤
│  Body text in secondary font showing how     │  Text block
│  your typography works for reading.          │
├──────────────────────────────────────────────┤
│  ┌──────────┐                                │
│  │  [img]   │ Card Title (primary font)      │  Card
│  │          │ Description text (secondary)   │
│  └──────────┘                                │
└──────────────────────────────────────────────┘
```

Apply inline styles for immediate color updates (no CSS variable delay):
- Use style={{ color: colors[3], fontFamily: secondaryFont }}
- Use style={{ backgroundColor: colors[0] }} for CTA

Add `ui-preview-element` class to elements that need font transition.
Add `updating` class when isUpdating=true for fade transition.
  </action>
  <verify>
File exists with:
- UIPreviewMock export
- Props for logo, heroImage, primaryFont, secondaryFont, colors
- Header with logo and nav
- CTA button with primary color
- Text using secondary font
- Card with image thumbnail
  </verify>
  <done>
Generic interface mock displays all brand assets in realistic UI context.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update UIPreviewTile with reactive subscriptions</name>
  <files>src/components/tiles/UIPreviewTile.tsx, src/App.css</files>
  <action>
Rewrite UIPreviewTile to be a reactive preview that updates live (UIPV-05):

1. Use useShallow for selective state subscription (from zustand/react/shallow):
```typescript
import { useShallow } from 'zustand/react/shallow';

const brandAssets = useCanvasStore(
  useShallow((state) => ({
    primaryFont: state.assets.primaryFont,
    secondaryFont: state.assets.secondaryFont,
    colors: state.assets.colors,
    logo: state.assets.logo,
    heroImage: state.assets.heroImage,
  }))
);
```

2. Use useFontLoaderPreview hook to preload fonts before render:
```typescript
const { isReady } = useFontLoaderPreview({
  primary: brandAssets.primaryFont,
  secondary: brandAssets.secondaryFont
});
```

3. Track font changes for transition:
```typescript
const previousFonts = useRef({ primary: '', secondary: '' });
const [isUpdating, setIsUpdating] = useState(false);

useEffect(() => {
  if (primaryFont !== previousFonts.current.primary ||
      secondaryFont !== previousFonts.current.secondary) {
    setIsUpdating(true);
    // Wait for transition out, then update, then transition in
    const timer = setTimeout(() => setIsUpdating(false), 160);
    previousFonts.current = { primary: primaryFont, secondary: secondaryFont };
    return () => clearTimeout(timer);
  }
}, [primaryFont, secondaryFont]);
```

4. Render UIPreviewMock with brand assets:
```typescript
<Tile id="ui-preview" label="UI Preview" nonInteractive>
  <UIPreviewMock
    logo={brandAssets.logo}
    heroImage={brandAssets.heroImage}
    primaryFont={brandAssets.primaryFont}
    secondaryFont={brandAssets.secondaryFont}
    colors={brandAssets.colors}
    isUpdating={isUpdating}
  />
</Tile>
```

5. Add CSS for UIPreviewMock layout in App.css:
- .ui-preview-mock container with flexbox layout
- .ui-preview-header with logo, nav, CTA
- .ui-preview-hero with image and heading
- .ui-preview-text for body block
- .ui-preview-card for card component
- Scaled down (font-size: 10px base) to fit tile

Key requirements:
- LIVE-01: Updates within 100ms perceived delay (useShallow prevents unnecessary re-renders)
- LIVE-02: No Apply/Save button (direct subscription)
- LIVE-03: Font swaps in <100ms after load (useFontLoaderPreview preloads)
- LIVE-04: 150ms ease-out transition (CSS from 05-01)
- LIVE-05: No flickering (GPU transitions, font preload)
- UIPV-06: Not editable (nonInteractive prop already set)
  </action>
  <verify>
UIPreviewTile.tsx contains:
- useShallow import from zustand/react/shallow
- useFontLoaderPreview hook usage
- UIPreviewMock component usage
- No direct calls to setAssets (read-only)

App.css contains:
- .ui-preview-mock layout styles
- .ui-preview-header, .ui-preview-hero, etc.
  </verify>
  <done>
UI preview tile reactively updates when any brand asset changes, with smooth transitions.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Reactive UI preview tile showing brand assets as unified system:
- Header with logo and navigation
- Hero section with primary font heading and CTA button
- Body text in secondary font
- Card with image thumbnail
- Live updates when fonts, colors, or images change
  </what-built>
  <how-to-verify>
1. Run `npm run dev` and open http://localhost:5173
2. Observe UI Preview tile in bottom row showing interface mock
3. Click Primary Type tile, change font - verify preview updates smoothly (<100ms perceived)
4. Click Colors tile (Phase 4), change a color - verify preview updates instantly
5. Verify no flickering during font changes
6. Verify UI Preview tile is NOT editable (no hover overlay, no edit panel opens)
7. Hover over UI Preview tile - should NOT show edit overlay (nonInteractive)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues with the UI preview</resume-signal>
</task>

</tasks>

<verification>
1. `grep -l "useShallow" src/components/tiles/UIPreviewTile.tsx` confirms selective subscription
2. `grep -l "UIPreviewMock" src/components/tiles/*.tsx` confirms mock component
3. `npm run dev` shows reactive preview tile
4. Font changes trigger smooth transition, not instant flicker
5. Color changes update immediately
</verification>

<success_criteria>
- UI preview shows header, hero, text block, and card (UIPV-01)
- Primary font used for headings, secondary for body (UIPV-02)
- Palette colors applied to background, text, CTA, links (UIPV-03)
- Imagery thumbnail visible in hero and card (UIPV-04)
- Changes update within 100ms perceived delay (LIVE-01, LIVE-03)
- Smooth 150ms transitions, no flickering (LIVE-04, LIVE-05)
- Tile is not directly editable (UIPV-06)
</success_criteria>

<output>
After completion, create `.planning/phases/05-system-view/05-02-SUMMARY.md`
</output>
