---
phase: 05-system-view
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useFontLoaderPreview.ts
  - src/App.css
autonomous: true

must_haves:
  truths:
    - "Font changes trigger preload before visual update"
    - "Transitions use GPU-accelerated properties only"
  artifacts:
    - path: "src/hooks/useFontLoaderPreview.ts"
      provides: "Hook for preloading fonts before applying to preview"
      exports: ["useFontLoaderPreview"]
    - path: "src/App.css"
      provides: "GPU-accelerated transition classes"
      contains: ".ui-preview-updating"
  key_links:
    - from: "src/hooks/useFontLoaderPreview.ts"
      to: "src/services/googleFonts.ts"
      via: "loadFontWithFallback import"
      pattern: "import.*loadFontWithFallback"
---

<objective>
Create foundation hooks and CSS for the reactive UI preview tile.

Purpose: Enable flicker-free font swaps and smooth visual transitions for the system view.
Output: useFontLoaderPreview hook for font preloading, GPU-accelerated CSS transition classes.
</objective>

<execution_context>
@/Users/sannagranqvist/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sannagranqvist/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-system-view/05-RESEARCH.md

@src/services/googleFonts.ts
@src/App.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useFontLoaderPreview hook</name>
  <files>src/hooks/useFontLoaderPreview.ts</files>
  <action>
Create a hook that:
1. Accepts `fonts: { primary: string; secondary: string }` parameter
2. Returns `{ isReady: boolean; fontsLoaded: { primary: boolean; secondary: boolean } }`
3. Uses `loadFontWithFallback` from googleFonts.ts service
4. Loads both fonts in parallel on mount and when fonts change
5. Sets isReady=true only when BOTH fonts are loaded (or failed with fallback)
6. Uses a ref to track previous fonts and avoid re-loading if unchanged
7. Has 3s timeout per font (already in loadFontWithFallback)

Pattern from research:
```typescript
const previousFonts = useRef({ primary: '', secondary: '' });

useEffect(() => {
  if (primary === previousFonts.current.primary &&
      secondary === previousFonts.current.secondary) {
    return; // No change, skip load
  }
  previousFonts.current = { primary, secondary };

  Promise.all([
    loadFontWithFallback(primary),
    loadFontWithFallback(secondary)
  ]).then(([p, s]) => {
    setFontsLoaded({ primary: p.loaded, secondary: s.loaded });
    setIsReady(true);
  });
}, [primary, secondary]);
```

This prevents FOIT/FOUT by ensuring fonts are loaded before visual update.
  </action>
  <verify>
File exists at src/hooks/useFontLoaderPreview.ts with:
- useFontLoaderPreview export
- Imports loadFontWithFallback from googleFonts
- Returns isReady and fontsLoaded status
  </verify>
  <done>
Hook preloads both primary and secondary fonts in parallel, returns loading status.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add GPU-accelerated transition CSS classes</name>
  <files>src/App.css</files>
  <action>
Add CSS classes for smooth UI preview transitions (LIVE-04: 120-180ms ease-out):

```css
/* UI Preview Transitions - GPU accelerated (Phase 5) */
.ui-preview-element {
  transition: opacity 150ms ease-out, transform 150ms ease-out;
}

.ui-preview-element.updating {
  opacity: 0;
  transform: translateY(2px);
}

/* Colors update immediately - NO transition to prevent flickering */
.ui-preview-cta {
  /* Background and text colors update instantly */
  transition: opacity 150ms ease-out, transform 150ms ease-out;
}

.ui-preview-link {
  /* Accent colors update instantly */
  transition: opacity 150ms ease-out, transform 150ms ease-out;
}

/* will-change hint for actively animating elements */
.ui-preview-updating .ui-preview-element {
  will-change: opacity, transform;
}
```

Key points from research:
- ONLY transition opacity and transform (GPU-accelerated)
- Do NOT transition color properties (causes flickering)
- Use translateY for subtle motion, not translateX
- 150ms is sweet spot within 120-180ms range
- will-change only on actively updating elements
  </action>
  <verify>
App.css contains:
- .ui-preview-element class with opacity/transform transition
- .updating modifier class
- No transitions on background-color or color properties
  </verify>
  <done>
CSS provides smooth 150ms ease-out transitions for font swaps using only GPU-accelerated properties.
  </done>
</task>

</tasks>

<verification>
1. `grep -l "useFontLoaderPreview" src/hooks/*.ts` returns the hook file
2. `grep "ui-preview-element" src/App.css` shows transition classes
3. `npm run build` completes without errors
</verification>

<success_criteria>
- useFontLoaderPreview hook created with parallel font loading
- CSS transition classes added for GPU-accelerated updates
- No color property transitions (prevents flickering)
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/05-system-view/05-01-SUMMARY.md`
</output>
